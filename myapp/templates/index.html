<!DOCTYPE HTML>
<html>
<head>
<title>Flask-SocketIO Test</title>

    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.5/socket.io.min.js"></script>
    <script type="text/javascript" src="//code.jquery.com/jquery-1.4.2.min.js"></script>
    <link type="text/css" rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css">
    <link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='css/graph.css')}}">
    <link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='css/detail.css')}}">
    <link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='css/legend.css')}}">
    <link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='css/extensions.css')}}">
    <link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css')}}">
    <script src="{{ url_for('static', filename='js/d3.v3.js')}}"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
    <script>
        jQuery.noConflict();
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/rickshaw/1.5.1/rickshaw.min.js"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.15/jquery-ui.min.js"></script>

        <script src="http://d3js.org/d3.v3.min.js"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/Rickshaw.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/Rickshaw.Graph.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/Rickshaw.Class.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/Rickshaw.Compat.ClassList.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/Rickshaw.Graph.Renderer.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/Rickshaw.Graph.Renderer.Area.js') }}"></script>

    <script type="text/javascript" src="{{ url_for('static', filename='js/Rickshaw.Graph.Axis.Y.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/Rickshaw.Color.Palette.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/extensions.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/Rickshaw.Fixtures.Color.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/Rickshaw.Fixtures.RandomData.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/Rickshaw.Fixtures.Number.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/Rickshaw.Fixtures.Time.Local.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/Rickshaw.Graph.Smoother.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/Rickshaw.Graph.Behavior.Series.Highlight.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/Rickshaw.Graph.Behavior.Series.Order.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/Rickshaw.Graph.Behavior.Series.Toggle.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/Rickshaw.Graph.Axis.Time.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/Rickshaw.Graph.Legend.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/Rickshaw.Graph.Annotate.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/Rickshaw.Graph.HoverDetail.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/Rickshaw.Graph.RangeSlider.Preview.js') }}"></script>

    <script type="text/javascript" src="{{ url_for('static', filename='js/Rickshaw.Graph.RangeSlider.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/Rickshaw.Graph.Renderer.Stack.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/Rickshaw.Graph.Renderer.ScatterPlot.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/Rickshaw.Graph.Renderer.Bar.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/Rickshaw.Graph.Renderer.Line.js') }}"></script>

    
<script type="text/javascript" charset="utf-8">
Array.prototype.contains = function(v) {
    for(var i = 0; i < this.length; i++) {
        if(this[i] === v) return true;
    }
    return false;
};

Array.prototype.unique = function() {
    var arr = [];
    for(var i = 0; i < this.length; i++) {
        if(!arr.contains(this[i])) {
            arr.push(this[i]);
        }
    }
    return arr; 
}


        $(document).ready(function(){
            namespace = '';
            var socket = io.connect('http://' + document.domain + ':' + location.port + namespace);
            //console.log('http://' + document.domain + ':' + location.port + namespace);
            socket.on('conn', function(json)){
                var attributes=JSON.parse(json);
                console.log(attributes);
            }
            socket.on('my response', function(json) {
                // console.log(json);
                var j = JSON.parse(json);
                //$('#log').append('<br>' + $('<div/>').text('Received #' + json.m + ': ' + json.group+json.name).html());
                var value=j.name;
                var total=j.numele;
                var cluster=j.uniquecluster;
                var clusterele=j.countcluster;
                var color = j.colors;
                document.getElementById('log').innerHTML = "";
                // document.getElementById('timeline').innerHTML = "";
                document.getElementById('legend').innerHTML = "";
                // document.getElementById('preview').innerHTML = "";
                plot(value,total,cluster,clusterele);
                });



function plot(value,total,cluster,clusterele)
{
    var seriesData = [];
    for(var i=0;i < cluster.length;i++)
        seriesData.push([]);
    var n=Math.max.apply(Math, clusterele);
    var random = new Rickshaw.Fixtures.RandomData(n);
    for(var i=0;i < cluster.length;i++)
        {
            for (var j = 0; j < clusterele[i]; j++) {
                random.addData(seriesData);
            }
        }
    console.log(seriesData);
    dta= [];
    var palette = new Rickshaw.Color.Palette( { scheme: 'classic9' } );

    for(var i=0;i < cluster.length;i++)
    {
        dta.push({"color":palette.color(),"name":value[i],"data":seriesData[i]});
    }
    console.log(dta);
    // var jsonString = JSON.stringify(dta);
    // console.log('got something');
    // console.log(jsonString);

// instantiate our graph!


    var graph = new Rickshaw.Graph( {
        element: document.getElementById("log"),
        width: 900,
        height: 500,
        renderer: 'scatterplot',
        stroke: true,
        preserve: true,
        series: dta
    
    } );

graph.render();

var preview = new Rickshaw.Graph.RangeSlider( {
    graph: graph,
    element: document.getElementById('preview'),
} );

var hoverDetail = new Rickshaw.Graph.HoverDetail( {
    graph: graph,
    xFormatter: function(x) {
        return new Date(x * 1000).toString();
    }
} );

var annotator = new Rickshaw.Graph.Annotate( {
    graph: graph,
    element: document.getElementById('timeline')
} );

var legend = new Rickshaw.Graph.Legend( {
    graph: graph,
    element: document.getElementById('legend')

} );

var shelving = new Rickshaw.Graph.Behavior.Series.Toggle( {
    graph: graph,
    legend: legend
} );

var order = new Rickshaw.Graph.Behavior.Series.Order( {
    graph: graph,
    legend: legend
} );

var highlighter = new Rickshaw.Graph.Behavior.Series.Highlight( {
    graph: graph,
    legend: legend
} );

var smoother = new Rickshaw.Graph.Smoother( {
    graph: graph,
    element: document.querySelector('#smoother')
} );

var ticksTreatment = 'glow';

var xAxis = new Rickshaw.Graph.Axis.Time( {
    graph: graph,
    ticksTreatment: ticksTreatment,
    timeFixture: new Rickshaw.Fixtures.Time.Local()
} );

xAxis.render();

var yAxis = new Rickshaw.Graph.Axis.Y( {
    graph: graph,
    tickFormat: Rickshaw.Fixtures.Number.formatKMBT,
    ticksTreatment: ticksTreatment
} );

yAxis.render();


var controls = new RenderControls( {
    element: document.querySelector('form'),
    graph: graph
} );

// add some data every so often

   }
   
            $('form#clusterAll').submit(function(event) {
                socket.emit('clusterAll');
                return false;
            });
            $('form#clusterCountry').submit(function(event) {
                socket.emit('clusterCountry');
                return false;
            });
            $('form#clusterBalance').submit(function(event) {
                socket.emit('clusterBalance');
                return false;
            });
        });

</script>
</head>
<body>

<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#">Outliers</a>
    </div>

        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Dropdown <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
            <li><a href="#">Action</a></li>
            <li><a href="#">Another action</a></li>
            <li><a href="#">Something else here</a></li>
            <li class="divider"></li>
            <li><a href="#">Separated link</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>

   Cluster All:
   <form class="form-horizontal" id="clusterAll" method="POST" action="#">
  <fieldset>
    <legend>Cluster All</legend>
    <div class="form-group">
      <div class="col-lg-10 col-lg-offset-2">
        <input type="submit" class="btn btn-primary" value="clusterAll"/>
      </div>
    </div>
  </fieldset>
</form>
<form class="form-horizontal" id="clusterCountry" method="POST" action="#">
  <fieldset>
    <legend>Cluster Country</legend>
    <div class="form-group">
      <div class="col-lg-10 col-lg-offset-2">
        <input type="submit" class="btn btn-primary" value="clusterCountry"/>
      </div>
    </div>
  </fieldset>
</form>
<form class="form-horizontal" id="clusterBalance" method="POST" action="#">
  <fieldset>
    <legend>Cluster Balance</legend>
    <div class="form-group">
      <div class="col-lg-10 col-lg-offset-2">
        <input type="submit" class="btn btn-primary" value="clusterBalance"/>
      </div>
    </div>
  </fieldset>
</form>
<form class="form-horizontal" id="clusterBalance" method="POST" action="#">
  <fieldset>
    <legend>Cluster Balance</legend>
    <div class="form-group">
      <div class="col-lg-10 col-lg-offset-2">
        <input type="submit" class="btn btn-primary" value="clusterBalance"/>
      </div>
    </div>
  </fieldset>
</form>

    <section><div id="legend"></div></section>
    <h2>Receive:</h2>
    <div id="log"></div>
    <div id="timeline"></div>
    <div id="preview"></div>
    <div id="smoother"></div>
    <div id="chart"></div>

</body>
</html>
